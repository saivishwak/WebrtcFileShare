(this.webpackJsonpp2pelectron=this.webpackJsonpp2pelectron||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},125:function(e,t,n){},128:function(e,t,n){},160:function(e,t,n){},161:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),o=n(10),a=n.n(o),i=(n(112),n(11)),s=n(26),l=n(7),u=(n(113),c.a.createContext()),d=(n(114),n(57),n(201)),j=n(192),b=n(193),m=n(191),h=(n(115),n(2));var f=function(){return Object(r.useEffect)((function(){setTimeout((function(){document.querySelector(".splashScreen").style.display="none"}),1e3)}),[]),Object(h.jsx)("div",{className:"splashScreen",children:Object(h.jsx)("box-icon",{name:"javascript",type:"logo",animation:"tada",color:"#ffffff",size:"100px"})})};var O=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(!1),a=Object(i.a)(o,2),s=a[0],O=a[1],p=Object(r.useContext)(u),x=Object(l.f)();return Object(h.jsxs)("div",{className:"login",children:[p.auth?"":Object(h.jsx)(f,{}),Object(h.jsxs)("div",{className:"loginContainer",children:[Object(h.jsx)("div",{className:"typewriter",children:Object(h.jsxs)("h1",{children:["Hi,",Object(h.jsx)("span",{className:"typeweritter__span",style:{fontSize:"20px"},children:"Welcome to Bytebook"})]})}),Object(h.jsx)("p",{className:"textFadeIn",children:"A new way to share files."}),Object(h.jsxs)("form",{className:"loginForm",children:[Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(h.jsx)("box-icon",{type:"solid",name:"terminal",color:"white",size:"20px"}),Object(h.jsx)("p",{style:{marginLeft:"10px"},children:"Enter your name to get started"})]}),Object(h.jsx)("input",{autoFocus:!0,className:"loginContainer__input",onChange:function(e){return c(e.target.value)},placeholder:"Username",type:"text",value:n,maxLength:"50",style:{width:"100%"}}),Object(h.jsx)("div",{className:"loginContainer_bottom",children:Object(h.jsx)("button",{className:"signinButton",onClick:function(e){e.preventDefault(),n.length>0?(localStorage.setItem("user",JSON.stringify({userName:n.trim(),avatarSeed:Math.random()})),p.setAuth(!0),x.push("/")):O(!0)},children:"Get Started"})})]}),Object(h.jsx)("div",{className:"login__footer",children:Object(h.jsx)("p",{children:"\xa9 2021 - present Bytebook.co Released under the MIT License"})})]}),Object(h.jsxs)(d.a,{open:s,onClose:function(){O(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Error type: Name"}),Object(h.jsx)(j.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Username cannot be empty. Please enter a valid username to get started."})})]})]})},p=n(30),x=n.n(p),g=n(43),v=(n(122),n(123),n(52)),N=n.n(v);var S=function(e){return Object(h.jsxs)("div",{className:"board",children:[Object(h.jsx)("div",{className:"boardTop",children:Object(h.jsx)("button",{value:e.id,className:"board_Close","aria-label":"delete",onClick:e.onClose,children:Object(h.jsx)(N.a,{className:"board_CloseIcon"})})}),Object(h.jsx)("div",{className:"boardBotton",id:e.id+"/"+e.roomName,onClick:e.onClick,children:Object(h.jsx)("h3",{id:e.id+"/"+e.roomName,children:e.roomName})})]})},y=n(93),C=n.n(y);n(125);var D=function(e){return e.bool?Object(h.jsx)("div",{className:"createRoomDialog",children:Object(h.jsxs)("form",{className:"createRoomDialog__container",onSubmit:e.createRoom,children:[Object(h.jsx)(N.a,{onClick:e.onClose,className:"createRoomDialog__close"}),Object(h.jsx)("input",{autoFocus:!0,placeholder:"Room name",required:!0,maxLength:"20",value:e.roomName,onChange:function(t){return e.setRoomName(t.target.value)}}),Object(h.jsx)("button",{type:"submit",onClick:e.createRoom,children:"Create Room"}),Object(h.jsx)("p",{children:"Last step to share your files!"})]})}):""},w=n(92),k=n(65),I=n.n(k),R=new(n(64).default)("bytebook");R.version(1).stores({rooms:"roomId,roomName,roomData"}),R.open().catch((function(e){console.log(e)}));var _=R;var z=function(){var e=Object(l.f)(),t=Object(r.useContext)(u),n=(localStorage.getItem("user"),Object(r.useState)(!1)),c=Object(i.a)(n,2),o=c[0],a=c[1],s=Object(r.useState)(""),d=Object(i.a)(s,2),j=d[0],b=d[1],m=function(){var e=Object(g.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=j.length){e.next=2;break}return e.abrupt("return");case 2:return t.preventDefault(),e.next=5,_.rooms.add({roomId:I.a.v4(),roomName:j,roomData:[]});case 5:a(!1),b("");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=Object(w.useLiveQuery)((function(){return _.rooms.toArray()}),[]);if(!O)return null;var p=function(){var e=Object(g.a)(x.a.mark((function e(t){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.rooms.delete(t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(t){e.push("/room/".concat(t.target.id))},N=O.map((function(e){var t=e.roomName,n=e.roomId;return Object(h.jsx)(S,{roomName:t,id:n,onClose:p,onClick:v},n)}));return Object(h.jsxs)("div",{className:"home",children:[t.auth?Object(h.jsx)(f,{}):"",Object(h.jsx)("h1",{children:"Recent Rooms"}),O.length>0?Object(h.jsx)("div",{className:"homeContainer__rooms",children:N}):Object(h.jsxs)("div",{className:"homeContainer__roomsEmpty",children:[Object(h.jsx)("p",{children:"Start by joining a room using the + button"}),Object(h.jsx)("p",{children:"Devices must join same room to share files with each other"})]}),Object(h.jsxs)("button",{className:"home_CreatButton",onClick:function(){return a(!0)},children:[Object(h.jsx)(C.a,{}),Object(h.jsx)("h2",{children:"New Room"})]}),Object(h.jsx)(D,{bool:o,onClose:function(){return a(!1)},createRoom:m,setRoomName:b,roomName:j})]})},B=n(35),M=(n(128),n(94)),E=n.n(M),F=n(95),T=n.n(F),L=n(96),J=n.n(L),U=n(97),A=n.n(U),P=n(202),W=n(194),q=n(196),G=n(200),H=n(199),K=n(195),Q=n(197),Y=n(198),Z=n(188);function V(){return new Worker(n.p+"static/js/web.worker.ee21e614.worker.js")}var X=Object(W.a)({table:{minWidth:650}});var $=function(e){var t=X(),n=(Object(r.useContext)(u),Object(l.g)().roomId),c=Object(l.g)().roomName,o=Object(r.useState)([]),a=Object(i.a)(o,2),O=a[0],p=a[1],v=JSON.parse(localStorage.getItem("user")),N=Object(r.useState)([]),S=Object(i.a)(N,2),y=S[0],C=S[1],D=Object(r.useRef)(),w=Object(r.useRef)(),k=Object(r.useRef)(),I=Object(r.useRef)(),R=Object(r.useRef)([]),z=Object(r.useState)(""),M=Object(i.a)(z,2),F=(M[0],M[1],Object(r.useRef)()),L=Object(r.useState)([]),U=Object(i.a)(L,2),W=(U[0],U[1]),$=Object(r.useState)(!0),ee=Object(i.a)($,2),te=ee[0],ne=ee[1],re=Object(r.useRef)(),ce=Object(r.useState)(!0),oe=Object(i.a)(ce,2),ae=oe[0],ie=oe[1];function se(e){D.current=le(e),I.current=D.current.createDataChannel("sendChannel"),I.current.onmessage=he}function le(e){var t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"test1234",username:"saivishwak40@gmail.com"}]});return t.onicecandidate=je,t.onnegotiationneeded=function(){return function(e){D.current.createOffer().then((function(e){return D.current.setLocalDescription(e)})).then((function(){var t={target:e,caller:w.current.id,sdp:D.current.localDescription};w.current.emit("offer",t)})).catch((function(e){return console.log(e)}))}(e)},t}function ue(e){D.current=le(),D.current.ondatachannel=function(e){I.current=e.channel,I.current.onmessage=he};var t=new RTCSessionDescription(e.sdp);D.current.setRemoteDescription(t).then((function(){})).then((function(){return D.current.createAnswer()})).then((function(e){return D.current.setLocalDescription(e)})).then((function(){var t={target:e.caller,caller:w.current.id,sdp:D.current.localDescription};w.current.emit("answer",t)}))}function de(e){var t=new RTCSessionDescription(e.sdp);D.current.setRemoteDescription(t).catch((function(e){return console.log(e)}))}function je(e){if(e.candidate){var t={target:k.current,candidate:e.candidate};w.current.emit("ice-candidate",t)}}function be(e){var t=new RTCIceCandidate(e);D.current.addIceCandidate(t).catch((function(e){return console.log(e)}))}function me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,r=t<0?0:t,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(r))+" "+c[o]}function he(e){if("Done"==e.data.toString().substring(0,4)){var t=new Blob(R.current);console.log("file",t,"meta",F.current),J()(t,F.current.name,F.current.type);var r=F.current,c=O.filter((function(e){return e.id!==r.id}));c.push({id:r.id,fileName:r.name,fileSize:me(r.size),operation:"Received"}),p((function(e){return c})),re.current.push({id:r.id,fileName:r.name,fileSize:me(r.size),operation:"Received"}),_.rooms.update({roomId:n},{roomData:re.current}),F.current={},R.current=[]}else"Meta"==e.data.toString().substring(0,4)?(F.current=JSON.parse(e.data.toString().substring(5,e.data.toString().length)),p((function(e){return[].concat(Object(B.a)(e),[{id:F.current.id,fileName:F.current.name,fileSize:me(F.current.size),operation:"Receiving"}])})),console.log(F.current,"meta")):(console.log("recieving data"),R.current.push(e.data))}Object(r.useEffect)(Object(g.a)(x.a.mark((function e(){var t,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="wss://p2p.bytebook.co:9000",console.log("Socket URL : ",t),w.current=E.a.connect(t),w.current.emit("join room",{userName:v.userName,roomID:n}),w.current.on("get socketID",(function(e){console.log("get socketID",e),C((function(t){return[{userName:e.userName,socketID:e.socketID}]}))})),w.current.on("user joined",(function(e){k.current=e.socketID,console.log("User Joined",e.socketID),C((function(t){return[].concat(Object(B.a)(t),[e])}))})),w.current.on("other user",(function(e){se(e.socketID),k.current=e.socketID,console.log("Other user",e.socketID),C((function(t){return[].concat(Object(B.a)(t),[e])}))})),w.current.on("offer",ue),w.current.on("answer",de),w.current.on("user left",(function(e){C((function(t){return t.filter((function(t){return t.socketID!==e}))})),console.log("User left",e)})),w.current.on("ice-candidate",be),e.next=13,_.rooms.get({roomId:n});case 13:if(r=e.sent){e.next=21;break}return e.next=17,_.rooms.add({roomId:n,roomName:c,roomData:[]});case 17:p((function(e){return[]})),re.current=[],e.next=23;break;case 21:p((function(e){return r.roomData})),re.current=r.roomData;case 23:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)((function(){return function(){console.log("componentWillUnmount"),w.current&&w.current.close()}}),[]),Object(r.useEffect)((function(){console.log(y),1==y.length?ne(!0):ne(!1)}),[y]);var fe=y.map((function(e){var t=e.userName;e.socketID;return Object(h.jsxs)("div",{className:"roomMiddleContainerEach",children:[Object(h.jsx)(P.a,{children:t.substring(0,1)}),Object(h.jsx)("p",{children:t})]})}));return Object(h.jsxs)("div",{className:"room",children:[Object(h.jsx)(f,{}),Object(h.jsxs)("div",{className:"roomTopContainer",children:[Object(h.jsx)(s.b,{to:"/",children:Object(h.jsx)("box-icon",{name:"arrow-back",flip:"vertical",color:"#636979",size:"25px"})}),Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(h.jsx)("h3",{style:{marginBottom:"5px"},children:c}),Object(h.jsx)("p",{style:{color:"#636979"},children:"Room Name"})]}),Object(h.jsx)("box-icon",{name:"share-alt",type:"solid",flip:"vertical",color:"#636979",size:"25px","aria-label":"Click to copy url",onClick:function(e){e.preventDefault(),T()(window.location.href),ie(!1),setTimeout((function(){ie(!0)}),[2e3])}})]}),Object(h.jsxs)("div",{className:"roomMiddleContainer",children:[Object(h.jsx)("div",{className:"roomMiddleContainerAvatars",children:fe}),y.length>1?"":Object(h.jsx)("p",{children:"No one is in the room. Share your url to start"})]}),Object(h.jsx)("div",{className:"roomBottomContainer",children:Object(h.jsx)(K.a,{component:Z.a,children:Object(h.jsxs)(q.a,{className:t.table,"aria-label":"table",children:[Object(h.jsx)(Q.a,{children:Object(h.jsxs)(Y.a,{children:[Object(h.jsx)(H.a,{children:"#"}),Object(h.jsx)(H.a,{align:"right",children:"ID"}),Object(h.jsx)(H.a,{align:"right",children:"File Name"}),Object(h.jsx)(H.a,{align:"right",children:"File Size"}),Object(h.jsx)(H.a,{align:"right",children:"Status"}),Object(h.jsx)(H.a,{align:"right",children:"Delete"})]})}),Object(h.jsx)(G.a,{children:O.map((function(e,t){return Object(h.jsxs)(Y.a,{children:[Object(h.jsx)(H.a,{component:"th",scope:"row",children:t+1}),Object(h.jsx)(H.a,{align:"right",children:e.id}),Object(h.jsx)(H.a,{align:"right",children:e.fileName}),Object(h.jsx)(H.a,{align:"right",children:e.fileSize}),Object(h.jsx)(H.a,{align:"right",children:e.operation}),Object(h.jsx)(H.a,{align:"right",children:Object(h.jsx)(A.a,{className:"roomTalbeDelete",onClick:function(t){var r=O.filter((function(t){return t.id!=e.id}));_.rooms.update(n,{roomData:r}),p((function(e){return r}))}})})]},t)}))})]})})}),Object(h.jsx)("input",{className:te?"room_sendFile buttonDisabled":"room_sendFile",disabled:te,type:"file",title:"Select File",onChange:function(e){try{var t,r=e.target.files,c=new V;c.postMessage({files:r}),c.addEventListener("message",(function(e){if("Done"==e.data){I.current.send("Done-".concat(JSON.stringify(t))),W((function(e){return[].concat(Object(B.a)(e),[t])}));var r=O.filter((function(e){return e.id!==t.id}));return r.push({id:t.id,fileName:t.name,fileSize:me(t.size),operation:"Sent"}),p((function(e){return r})),re.current.push({id:t.id,fileName:t.name,fileSize:me(t.size),operation:"Sent"}),_.rooms.update({roomId:n},{roomData:re.current}),void c.terminate()}if("string"==typeof e.data)e.data.includes("Meta-")&&(t=JSON.parse(e.data.substring(5,e.data.length)),p((function(e){return[].concat(Object(B.a)(e),[{id:t.id,fileName:t.name,fileSize:me(t.size),operation:"Sending"}])})),I.current.send("Meta-".concat(e.data.substring(5,e.data.length)))),console.log(e.data);else{if("open"!=I.current.readyState)return c.postMessage("error"),alert("something went wrong");I.current.send(e.data)}}))}catch(o){console.log(o)}}}),Object(h.jsxs)(d.a,{open:!ae,onClose:function(){ie(!0)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Clipboard"}),Object(h.jsx)(j.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Url copied to your clipboard. Share this with peer to start sharing"})})]})]})};n(160);var ee=function(){return Object(h.jsx)("div",{className:"page404",children:Object(h.jsxs)("div",{className:"page404_container",children:[Object(h.jsxs)("h1",{children:["404",Object(h.jsx)("span",{children:" Error"})]}),Object(h.jsx)("img",{src:"/page404.png",width:"400px"})]})})};var te=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){localStorage.getItem("user")&&c(!0)}),[]),Object(h.jsx)("div",{className:"app",children:Object(h.jsx)(u.Provider,{value:{auth:n,setAuth:c},children:n?Object(h.jsx)(s.a,{children:Object(h.jsxs)(l.c,{children:[Object(h.jsx)(l.a,{path:"/room/:roomId/:roomName",children:Object(h.jsx)($,{})}),Object(h.jsx)(l.a,{exact:!0,path:"/",children:Object(h.jsx)(z,{})}),Object(h.jsx)(l.a,{path:"*",component:ee})]})}):Object(h.jsx)(O,{})})})};a.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(s.a,{children:Object(h.jsx)(te,{})})}),document.getElementById("root"))}},[[161,1,2]]]);
//# sourceMappingURL=main.c108ae45.chunk.js.map