(this.webpackJsonpp2pelectron=this.webpackJsonpp2pelectron||[]).push([[0],{116:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){},129:function(e,t,n){},132:function(e,t,n){},170:function(e,t,n){},171:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(10),o=n.n(a),i=(n(116),n(11)),s=n(26),l=n(7),u=(n(117),c.a.createContext()),d=(n(118),n(57),n(211)),j=n(202),b=n(203),m=n(201),h=(n(119),n(2));var f=function(){return Object(r.useEffect)((function(){setTimeout((function(){document.querySelector(".splashScreen").style.display="none"}),1e3)}),[]),Object(h.jsx)("div",{className:"splashScreen",children:Object(h.jsx)("box-icon",{name:"javascript",type:"logo",animation:"tada",color:"#ffffff",size:"100px"})})};var O=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(!1),o=Object(i.a)(a,2),s=o[0],O=o[1],x=Object(r.useContext)(u),p=Object(l.f)();return Object(h.jsxs)("div",{className:"login",children:[x.auth?"":Object(h.jsx)(f,{}),Object(h.jsxs)("div",{className:"loginContainer",children:[Object(h.jsx)("div",{className:"typewriter",children:Object(h.jsxs)("h1",{children:["Hi,",Object(h.jsx)("span",{className:"typeweritter__span",style:{fontSize:"20px"},children:"Welcome to Bytebook"})]})}),Object(h.jsx)("p",{className:"textFadeIn",children:"A new way to share files."}),Object(h.jsxs)("form",{className:"loginForm",children:[Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(h.jsx)("box-icon",{type:"solid",name:"terminal",color:"white",size:"20px"}),Object(h.jsx)("p",{style:{marginLeft:"10px"},children:"Enter your name to get started"})]}),Object(h.jsx)("input",{autoFocus:!0,className:"loginContainer__input",onChange:function(e){return c(e.target.value)},placeholder:"Username",type:"text",value:n,maxLength:"50",style:{width:"100%"}}),Object(h.jsx)("div",{className:"loginContainer_bottom",children:Object(h.jsx)("button",{className:"signinButton",onClick:function(e){e.preventDefault(),n.length>0?(localStorage.setItem("user",JSON.stringify({userName:n.trim(),avatarSeed:Math.random()})),x.setAuth(!0),p.push("/")):O(!0)},children:"Get Started"})})]}),Object(h.jsx)("div",{className:"login__footer",children:Object(h.jsx)("p",{children:"\xa9 2021 - present Bytebook.co Released under the MIT License"})})]}),Object(h.jsxs)(d.a,{open:s,onClose:function(){O(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Error type: Name"}),Object(h.jsx)(j.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Username cannot be empty. Please enter a valid username to get started."})})]})]})},x=n(30),p=n.n(x),g=n(42),v=(n(126),n(127),n(52)),N=n.n(v);var C=function(e){return Object(h.jsxs)("div",{className:"board",children:[Object(h.jsx)("div",{className:"boardTop",children:Object(h.jsx)("button",{value:e.id,className:"board_Close","aria-label":"delete",onClick:e.onClose,children:Object(h.jsx)(N.a,{className:"board_CloseIcon"})})}),Object(h.jsx)("div",{className:"boardBotton",id:e.id+"/"+e.roomName,onClick:e.onClick,children:Object(h.jsx)("h3",{id:e.id+"/"+e.roomName,children:e.roomName})})]})},y=n(97),S=n.n(y);n(129);var w=function(e){return e.bool?Object(h.jsx)("div",{className:"createRoomDialog",children:Object(h.jsxs)("form",{className:"createRoomDialog__container",onSubmit:e.createRoom,children:[Object(h.jsx)(N.a,{onClick:e.onClose,className:"createRoomDialog__close"}),Object(h.jsx)("input",{autoFocus:!0,placeholder:"Room name",required:!0,maxLength:"20",value:e.roomName,onChange:function(t){return e.setRoomName(t.target.value)}}),Object(h.jsx)("button",{type:"submit",onClick:e.createRoom,children:"Create Room"}),Object(h.jsx)("p",{children:"Last step to share your files!"})]})}):""},D=n(96),k=n(65),I=n.n(k),R=new(n(64).default)("bytebook");R.version(1).stores({rooms:"roomId,roomName,roomData"}),R.open().catch((function(e){console.log(e)}));var _=R;var B=function(){var e=Object(l.f)(),t=Object(r.useContext)(u),n=(localStorage.getItem("user"),Object(r.useState)(!1)),c=Object(i.a)(n,2),a=c[0],o=c[1],s=Object(r.useState)(""),d=Object(i.a)(s,2),j=d[0],b=d[1],m=function(){var e=Object(g.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=j.length){e.next=2;break}return e.abrupt("return");case 2:return t.preventDefault(),e.next=5,_.rooms.add({roomId:I.a.v4(),roomName:j,roomData:[]});case 5:o(!1),b("");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=Object(D.useLiveQuery)((function(){return _.rooms.toArray()}),[]);if(!O)return null;var x=function(){var e=Object(g.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.rooms.delete(t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(t){e.push("/room/".concat(t.target.id))},N=O.map((function(e){var t=e.roomName,n=e.roomId;return Object(h.jsx)(C,{roomName:t,id:n,onClose:x,onClick:v},n)}));return Object(h.jsxs)("div",{className:"home",children:[t.auth?Object(h.jsx)(f,{}):"",Object(h.jsx)("h1",{children:"Recent Rooms"}),O.length>0?Object(h.jsx)("div",{className:"homeContainer__rooms",children:N}):Object(h.jsxs)("div",{className:"homeContainer__roomsEmpty",children:[Object(h.jsx)("p",{children:"Start by joining a room using the + button"}),Object(h.jsx)("p",{children:"Devices must join same room to share files with each other"})]}),Object(h.jsxs)("button",{className:"home_CreatButton",onClick:function(){return o(!0)},children:[Object(h.jsx)(S.a,{}),Object(h.jsx)("h2",{children:"New Room"})]}),Object(h.jsx)(w,{bool:a,onClose:function(){return o(!1)},createRoom:m,setRoomName:b,roomName:j})]})},z=n(43),M=(n(132),n(98)),E=n.n(M),F=n(99),T=n.n(F),L=n(100),J=n.n(L),A=n(101),P=n.n(A),Q=n(212),U=n(204),W=n(206),q=n(210),G=n(209),H=n(205),K=n(207),Y=n(208),Z=n(198);function V(){return new Worker(n.p+"static/js/web.worker.ccbaee63.worker.js")}var X=n(164),$=Object(U.a)({table:{minWidth:650}});var ee=function(e){var t=$(),n=(Object(r.useContext)(u),Object(l.f)(),Object(l.g)().roomId),c=Object(l.g)().roomName,a=Object(r.useState)([]),o=Object(i.a)(a,2),O=o[0],x=o[1],v=JSON.parse(localStorage.getItem("user")),N=Object(r.useState)([]),C=Object(i.a)(N,2),y=C[0],S=C[1],w=Object(r.useRef)(),D=Object(r.useRef)(),k=Object(r.useRef)(),I=Object(r.useRef)(),R=Object(r.useRef)([]),B=Object(r.useState)(""),M=Object(i.a)(B,2),F=(M[0],M[1],Object(r.useRef)()),L=Object(r.useState)([]),A=Object(i.a)(L,2),U=(A[0],A[1],Object(r.useState)(!0)),ee=Object(i.a)(U,2),te=ee[0],ne=ee[1],re=Object(r.useRef)(),ce=Object(r.useState)(!0),ae=Object(i.a)(ce,2),oe=ae[0],ie=ae[1];function se(e){w.current=le(e),I.current=w.current.createDataChannel("sendChannel"),I.current.onmessage=he}function le(e){var t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"test1234",username:"saivishwak40@gmail.com"}]});return t.onicecandidate=je,t.onnegotiationneeded=function(){return function(e){w.current.createOffer().then((function(e){return w.current.setLocalDescription(e)})).then((function(){var t={target:e,caller:D.current.id,sdp:w.current.localDescription};D.current.emit("offer",t)})).catch((function(e){return console.log(e)}))}(e)},t}function ue(e){w.current=le(),w.current.ondatachannel=function(e){I.current=e.channel,I.current.onmessage=he};var t=new RTCSessionDescription(e.sdp);w.current.setRemoteDescription(t).then((function(){})).then((function(){return w.current.createAnswer()})).then((function(e){return w.current.setLocalDescription(e)})).then((function(){var t={target:e.caller,caller:D.current.id,sdp:w.current.localDescription};D.current.emit("answer",t)}))}function de(e){var t=new RTCSessionDescription(e.sdp);w.current.setRemoteDescription(t).catch((function(e){return console.log(e)}))}function je(e){if(e.candidate){var t={target:k.current,candidate:e.candidate};D.current.emit("ice-candidate",t)}}function be(e){var t=new RTCIceCandidate(e);w.current.addIceCandidate(t).catch((function(e){return console.log(e)}))}function me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,r=t<0?0:t,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,a)).toFixed(r))+" "+c[a]}function he(e){if("Done"==e.data.toString().substring(0,4)){var t=new Blob(R.current);J()(t,F.current.name,F.current.type);var r=F.current;re.current.push({id:r.id,fileName:r.name,fileSize:me(r.size),operation:"Received"}),_.rooms.update({roomId:n},{roomData:re.current}),x((function(e){return re.current})),F.current={},R.current=[]}else"Meta"==e.data.toString().substring(0,4)?(F.current=JSON.parse(e.data.toString().substring(5,e.data.toString().length)),x((function(e){return[].concat(Object(z.a)(e),[{id:F.current.id,fileName:F.current.name,fileSize:me(F.current.size),operation:"Receiving"}])}))):R.current.push(e.data)}Object(r.useEffect)(Object(g.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"ws://localhost:9000",D.current=E.a.connect("ws://localhost:9000"),D.current.emit("join room",{userName:v.userName,roomID:n}),D.current.on("get socketID",(function(e){S((function(t){return[{userName:e.userName,socketID:e.socketID}]}))})),D.current.on("user joined",(function(e){k.current=e.socketID,S((function(t){return[].concat(Object(z.a)(t),[e])}))})),D.current.on("other user",(function(e){se(e.socketID),k.current=e.socketID,S((function(t){return[].concat(Object(z.a)(t),[e])}))})),D.current.on("room full",(function(e){return alert("Room Full, Please use a different room!")})),D.current.on("offer",ue),D.current.on("answer",de),D.current.on("user left",(function(e){S((function(t){return t.filter((function(t){return t.socketID!==e}))}))})),D.current.on("ice-candidate",be),e.next=13,_.rooms.get({roomId:n});case 13:if(t=e.sent){e.next=21;break}return e.next=17,_.rooms.add({roomId:n,roomName:c,roomData:[]});case 17:x((function(e){return[]})),re.current=[],e.next=23;break;case 21:x((function(e){return t.roomData})),re.current=t.roomData;case 23:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)((function(){return function(){D.current&&D.current.close()}}),[]),Object(r.useEffect)((function(){1==y.length?ne(!0):ne(!1)}),[y]);var fe=y.map((function(e){var t=e.userName;e.socketID;return Object(h.jsxs)("div",{className:"roomMiddleContainerEach",children:[Object(h.jsx)(Q.a,{children:t.substring(0,1)}),Object(h.jsx)("p",{children:t})]})}));return Object(h.jsxs)("div",{className:"room",children:[Object(h.jsx)(f,{}),Object(h.jsxs)("div",{className:"roomTopContainer",children:[Object(h.jsx)(s.b,{to:"/",children:Object(h.jsx)("box-icon",{name:"arrow-back",flip:"vertical",color:"#636979",size:"25px"})}),Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(h.jsx)("h3",{style:{marginBottom:"5px"},children:c}),Object(h.jsx)("p",{style:{color:"#636979"},children:"Room Name"})]}),Object(h.jsx)("box-icon",{name:"share-alt",type:"solid",flip:"vertical",color:"#636979",size:"25px","aria-label":"Click to copy url",onClick:function(e){e.preventDefault(),T()(window.location.href),ie(!1),setTimeout((function(){ie(!0)}),[2e3])}})]}),Object(h.jsxs)("div",{className:"roomMiddleContainer",children:[Object(h.jsx)("div",{className:"roomMiddleContainerAvatars",children:fe}),y.length>1?"":Object(h.jsxs)("div",{className:"roomQrCodeContainer",children:[Object(h.jsx)(X,{value:window.location.href,size:256,includeMargin:!1,bgColor:"#c5c7cc"}),Object(h.jsx)("p",{children:"No one is in the room. Scan this Qr Code or copy the link to start sharing \ud83d\ude80"})]})]}),Object(h.jsx)("div",{className:"roomBottomContainer",children:Object(h.jsx)(H.a,{component:Z.a,children:Object(h.jsxs)(W.a,{className:t.table,"aria-label":"table",children:[Object(h.jsx)(K.a,{children:Object(h.jsxs)(Y.a,{children:[Object(h.jsx)(G.a,{children:"#"}),Object(h.jsx)(G.a,{align:"right",children:"ID"}),Object(h.jsx)(G.a,{align:"right",children:"File Name"}),Object(h.jsx)(G.a,{align:"right",children:"File Size"}),Object(h.jsx)(G.a,{align:"right",children:"Status"}),Object(h.jsx)(G.a,{align:"right",children:"Delete"})]})}),Object(h.jsx)(q.a,{children:O.map((function(e,t){return Object(h.jsxs)(Y.a,{children:[Object(h.jsx)(G.a,{component:"th",scope:"row",children:t+1}),Object(h.jsx)(G.a,{align:"right",children:e.id}),Object(h.jsx)(G.a,{align:"right",children:e.fileName}),Object(h.jsx)(G.a,{align:"right",children:e.fileSize}),Object(h.jsx)(G.a,{align:"right",children:e.operation}),Object(h.jsx)(G.a,{align:"right",children:Object(h.jsx)(P.a,{className:"roomTalbeDelete",onClick:function(t){var r=O.filter((function(t){return t.id!=e.id}));_.rooms.update(n,{roomData:r}),x((function(e){return r})),re.current=r}})})]},t)}))})]})})}),Object(h.jsx)("input",{className:te?"room_sendFile buttonDisabled":"room_sendFile",disabled:te,type:"file",title:"Select File",onChange:function(e){try{var t,r=e.target.files,c=new V;c.postMessage({files:r}),c.addEventListener("message",(function(e){if("Done"==e.data)return I.current.send("Done-".concat(JSON.stringify(t))),re.current.push({id:t.id,fileName:t.name,fileSize:me(t.size),operation:"Sent"}),x((function(e){return re.current})),_.rooms.update({roomId:n},{roomData:re.current}),void c.terminate();if("string"==typeof e.data)e.data.includes("Meta-")&&(t=JSON.parse(e.data.substring(5,e.data.length)),x((function(e){return[].concat(Object(z.a)(e),[{id:t.id,fileName:t.name,fileSize:me(t.size),operation:"Sending"}])})),I.current.send("Meta-".concat(e.data.substring(5,e.data.length))));else{if("open"!=I.current.readyState)return c.terminate(),window.location.reload();I.current.send(e.data)}}))}catch(a){console.log(a)}}}),Object(h.jsxs)(d.a,{open:!oe,onClose:function(){ie(!0)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Clipboard"}),Object(h.jsx)(j.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Url copied to your clipboard. Share this with peer to start sharing"})})]})]})};n(170);var te=function(){return Object(h.jsx)("div",{className:"page404",children:Object(h.jsxs)("div",{className:"page404_container",children:[Object(h.jsxs)("h1",{children:["404",Object(h.jsx)("span",{children:" Error"})]}),Object(h.jsx)("img",{src:"/page404.png",width:"400px"})]})})};var ne=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){localStorage.getItem("user")&&c(!0)}),[]),Object(h.jsx)("div",{className:"app",children:Object(h.jsx)(u.Provider,{value:{auth:n,setAuth:c},children:n?Object(h.jsx)(s.a,{children:Object(h.jsxs)(l.c,{children:[Object(h.jsx)(l.a,{path:"/room/:roomId/:roomName",children:Object(h.jsx)(ee,{})}),Object(h.jsx)(l.a,{exact:!0,path:"/",children:Object(h.jsx)(B,{})}),Object(h.jsx)(l.a,{path:"*",component:te})]})}):Object(h.jsx)(O,{})})})};o.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(s.a,{children:Object(h.jsx)(ne,{})})}),document.getElementById("root"))}},[[171,1,2]]]);
//# sourceMappingURL=main.4ae5e368.chunk.js.map