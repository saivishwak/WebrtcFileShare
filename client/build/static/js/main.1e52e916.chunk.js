(this.webpackJsonpp2pelectron=this.webpackJsonpp2pelectron||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},121:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},125:function(e,t,n){},128:function(e,t,n){},160:function(e,t,n){},161:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),o=n(10),a=n.n(o),i=(n(112),n(11)),s=n(26),l=n(7),u=(n(113),c.a.createContext()),j=(n(114),n(58),n(202)),d=n(193),b=n(194),m=n(192),h=n(2);var O=function(){var e=Object(r.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(!1),a=Object(i.a)(o,2),s=a[0],O=a[1],f=Object(r.useContext)(u),p=Object(l.f)();return Object(h.jsxs)("div",{className:"login",children:[Object(h.jsxs)("div",{className:"loginContainer",children:[Object(h.jsx)("div",{className:"typewriter",children:Object(h.jsxs)("h1",{children:["Hi,",Object(h.jsx)("span",{className:"typeweritter__span",style:{fontSize:"20px"},children:"Welcome to Bytebook"})]})}),Object(h.jsx)("p",{className:"textFadeIn",children:"A new way to share files."}),Object(h.jsxs)("form",{className:"loginForm",children:[Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(h.jsx)("box-icon",{type:"solid",name:"terminal",color:"white",size:"20px"}),Object(h.jsx)("p",{style:{marginLeft:"10px"},children:"Enter your name to get started"})]}),Object(h.jsx)("input",{className:"loginContainer__input",onChange:function(e){return c(e.target.value)},placeholder:"Username",type:"text",value:n,maxLength:"50",style:{width:"100%"}}),Object(h.jsx)("div",{className:"loginContainer_bottom",children:Object(h.jsx)("button",{className:"signinButton",onClick:function(e){e.preventDefault(),n.length>0?(localStorage.setItem("user",JSON.stringify({userName:n,avatarSeed:Math.random()})),f.setAuth(!0),p.push("/")):O(!0)},children:"Get Started"})})]}),Object(h.jsx)("div",{className:"login__footer",children:Object(h.jsx)("p",{children:"\xa9 2021 - present Bytebook.co Released under the MIT License"})})]}),Object(h.jsxs)(j.a,{open:s,onClose:function(){O(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Error type: Name"}),Object(h.jsx)(d.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Username cannot be empty. Please enter a valid username to get started."})})]})]})},f=n(30),p=n.n(f),x=n(44);n(121),n(122);var g=function(){return Object(r.useEffect)((function(){setTimeout((function(){document.querySelector(".splashScreen").style.display="none"}),1e3)}),[]),Object(h.jsx)("div",{className:"splashScreen",children:Object(h.jsx)("box-icon",{name:"javascript",type:"logo",animation:"tada",color:"#ffffff",size:"100px"})})},v=(n(123),n(53)),N=n.n(v);var y=function(e){return Object(h.jsxs)("div",{className:"board",children:[Object(h.jsxs)("div",{className:"boardTop",children:[Object(h.jsx)("div",{style:{flex:1}}),Object(h.jsx)("button",{value:e.id,className:"board_Close","aria-label":"delete",onClick:e.onClose,children:Object(h.jsx)(N.a,{className:"board_CloseIcon"})})]}),Object(h.jsx)("div",{className:"boardBotton",id:e.id+"/"+e.roomName,onClick:e.onClick,children:Object(h.jsx)("h3",{id:e.id+"/"+e.roomName,children:e.roomName})})]})},S=n(93),C=n.n(S);n(125);var D=function(e){return e.bool?Object(h.jsx)("div",{className:"createRoomDialog",children:Object(h.jsxs)("div",{className:"createRoomDialog__container",children:[Object(h.jsx)(N.a,{onClick:e.onClose,className:"createRoomDialog__close"}),Object(h.jsx)("input",{placeholder:"Room name",maxLength:"20",value:e.roomName,onChange:function(t){return e.setRoomName(t.target.value)}}),Object(h.jsx)("button",{onClick:e.createRoom,children:"Create Room"}),Object(h.jsx)("p",{children:"Last step to share your files!"})]})}):""},k=n(92),w=n(31),I=n.n(w),R=new(n(65).default)("bytebook");R.version(1).stores({rooms:"roomId,roomName,roomData"}),R.open().catch((function(e){console.log(e)}));var _=R;var B=function(){var e=Object(l.f)(),t=Object(r.useContext)(u),n=(localStorage.getItem("user"),Object(r.useState)(!1)),c=Object(i.a)(n,2),o=c[0],a=c[1],s=Object(r.useState)(""),j=Object(i.a)(s,2),d=j[0],b=j[1],m=function(){var e=Object(x.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,_.rooms.add({roomId:I.a.v4(),roomName:d,roomData:[]});case 3:a(!1),b("");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=Object(k.useLiveQuery)((function(){return _.rooms.toArray()}),[]);if(!O)return null;var f=function(){var e=Object(x.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.rooms.delete(t.target.value);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(t){e.push("/room/".concat(t.target.id))},N=O.map((function(e){var t=e.roomName,n=e.roomId;return Object(h.jsx)(y,{roomName:t,id:n,onClose:f,onClick:v},n)}));return Object(h.jsxs)("div",{className:"home",children:[t.auth?Object(h.jsx)(g,{}):"",Object(h.jsx)("h1",{children:"Recent Rooms"}),O.length>0?Object(h.jsx)("div",{className:"homeContainer__rooms",children:N}):Object(h.jsxs)("div",{className:"homeContainer__roomsEmpty",children:[Object(h.jsx)("p",{children:"Start by joining a room using the + button"}),Object(h.jsx)("p",{children:"Devices must join same room to share files with each other"})]}),Object(h.jsxs)("button",{className:"home_CreatButton",onClick:function(){return a(!0)},children:[Object(h.jsx)(C.a,{}),Object(h.jsx)("h2",{children:"New Room"})]}),Object(h.jsx)(D,{bool:o,onClose:function(){return a(!1)},createRoom:m,setRoomName:b,roomName:d})]})},E=n(36),z=n(195),T=n(197),L=n(201),M=n(200),F=n(196),U=n(198),A=n(199),J=n(189),P=(n(128),n(94)),W=n.n(P),H=n(97),K=n.n(H),G=n(203),V=n(95),Y=n.n(V),q=n(96),Q=n.n(q),Z=Object(z.a)({table:{minWidth:650}});var X=function(e){var t=Z(),n=(Object(r.useContext)(u),Object(l.g)().roomId),c=Object(l.g)().roomName,o=Object(r.useState)([]),a=Object(i.a)(o,2),O=a[0],f=a[1],v=JSON.parse(localStorage.getItem("user")),N=Object(r.useState)([]),y=Object(i.a)(N,2),S=y[0],C=y[1],D=Object(r.useRef)(),k=Object(r.useRef)(),w=Object(r.useRef)(),R=Object(r.useRef)(),B=Object(r.useRef)([]),z=Object(r.useState)(""),P=Object(i.a)(z,2),H=(P[0],P[1],Object(r.useRef)()),V=Object(r.useState)([]),q=Object(i.a)(V,2),X=q[0],$=q[1],ee=Object(r.useState)(!0),te=Object(i.a)(ee,2),ne=te[0],re=te[1],ce=Object(r.useRef)(),oe=Object(r.useState)(!0),ae=Object(i.a)(oe,2),ie=ae[0],se=ae[1];function le(e){D.current=ue(e),R.current=D.current.createDataChannel("sendChannel"),R.current.onmessage=Oe}function ue(e){var t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]});return t.onicecandidate=be,t.onnegotiationneeded=function(){return function(e){D.current.createOffer().then((function(e){return D.current.setLocalDescription(e)})).then((function(){var t={target:e,caller:k.current.id,sdp:D.current.localDescription};k.current.emit("offer",t)})).catch((function(e){return console.log(e)}))}(e)},t}function je(e){D.current=ue(),D.current.ondatachannel=function(e){R.current=e.channel,R.current.onmessage=Oe};var t=new RTCSessionDescription(e.sdp);D.current.setRemoteDescription(t).then((function(){})).then((function(){return D.current.createAnswer()})).then((function(e){return D.current.setLocalDescription(e)})).then((function(){var t={target:e.caller,caller:k.current.id,sdp:D.current.localDescription};k.current.emit("answer",t)}))}function de(e){var t=new RTCSessionDescription(e.sdp);D.current.setRemoteDescription(t).catch((function(e){return console.log(e)}))}function be(e){if(e.candidate){var t={target:w.current,candidate:e.candidate};k.current.emit("ice-candidate",t)}}function me(e){var t=new RTCIceCandidate(e);D.current.addIceCandidate(t).catch((function(e){return console.log(e)}))}function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,r=t<0?0:t,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(r))+" "+c[o]}function Oe(e){if("Done"==e.data.toString().substring(0,4)){var t=new Blob(B.current);console.log("file",t,"meta",H.current),W()(t,H.current.name,H.current.type);var r=H.current;f((function(e){return[].concat(Object(E.a)(e),[{id:I.a.v4(),fileName:r.name,fileSize:he(r.size),operation:"received"}])})),ce.current.push({id:I.a.v4(),fileName:r.name,fileSize:he(r.size),operation:"received"}),_.rooms.update({roomId:n},{roomData:ce.current}),H.current={},B.current=[]}else"Meta"==e.data.toString().substring(0,4)?(H.current=JSON.parse(e.data.toString().substring(5,e.data.toString().length)),console.log(H.current,"meta")):B.current.push(e.data)}Object(r.useEffect)(Object(x.a)(p.a.mark((function e(){var t,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="production"==Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).APP_ENV?"https://p2p.bytebook.co/ws":"http://localhost:9000",console.log("Socket URL : ",t),k.current=Q.a.connect("https://p2p.bytebook.co/ws"),k.current.emit("join room",{userName:v.userName,roomID:n}),k.current.on("get socketID",(function(e){console.log("get socketID",e),C((function(t){return[{userName:e.userName,socketID:e.socketID}]}))})),k.current.on("user joined",(function(e){w.current=e.socketID,console.log("User Joined",e.socketID),C((function(t){return[].concat(Object(E.a)(t),[e])}))})),k.current.on("other user",(function(e){le(e.socketID),w.current=e.socketID,console.log("Other user",e.socketID),C((function(t){return[].concat(Object(E.a)(t),[e])}))})),k.current.on("offer",je),k.current.on("answer",de),k.current.on("user left",(function(e){C((function(t){return t.filter((function(t){return t.socketID!==e}))})),console.log("User left",e)})),k.current.on("ice-candidate",me),e.next=13,_.rooms.get({roomId:n});case 13:if(r=e.sent){e.next=21;break}return e.next=17,_.rooms.add({roomId:n,roomName:c,roomData:[]});case 17:f((function(e){return[]})),ce.current=[],e.next=23;break;case 21:f((function(e){return r.roomData})),ce.current=r.roomData;case 23:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)((function(){return function(){console.log("componentWillUnmount"),k.current&&k.current.close()}}),[]),Object(r.useEffect)((function(){console.log(S),1==S.length?re(!0):re(!1)}),[S]);var fe=S.map((function(e){var t=e.userName;e.socketID;return Object(h.jsxs)("div",{className:"roomMiddleContainerEach",children:[Object(h.jsx)(G.a,{children:t.substring(0,1)}),Object(h.jsx)("p",{children:t})]})}));return X.map((function(e){var t=e.name;e.size;return Object(h.jsx)("p",{children:t})})),Object(h.jsxs)("div",{className:"room",children:[Object(h.jsx)(g,{}),Object(h.jsxs)("div",{className:"roomTopContainer",children:[Object(h.jsx)(s.b,{to:"/",children:Object(h.jsx)("box-icon",{name:"arrow-back",flip:"vertical",color:"#636979",size:"25px"})}),Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(h.jsx)("h3",{style:{marginBottom:"5px"},children:c}),Object(h.jsx)("p",{style:{color:"#636979"},children:"Room Name"})]}),Object(h.jsx)("box-icon",{name:"share-alt",type:"solid",flip:"vertical",color:"#636979",size:"25px","aria-label":"Click to copy url",onClick:function(e){e.preventDefault(),Y()(window.location.href),se(!1),setTimeout((function(){se(!0)}),[2e3])}})]}),Object(h.jsx)("div",{className:"roomMiddleContainer",children:Object(h.jsx)("div",{className:"roomMiddleContainerAvatars",children:fe})}),Object(h.jsx)("div",{className:"roomBottomContainer",children:O.length>0?Object(h.jsx)(F.a,{component:J.a,children:Object(h.jsxs)(T.a,{className:t.table,"aria-label":"table",children:[Object(h.jsx)(U.a,{children:Object(h.jsxs)(A.a,{children:[Object(h.jsx)(M.a,{children:"#"}),Object(h.jsx)(M.a,{align:"right",children:"ID"}),Object(h.jsx)(M.a,{align:"right",children:"File Name"}),Object(h.jsx)(M.a,{align:"right",children:"File Size"}),Object(h.jsx)(M.a,{align:"right",children:"Operation"}),Object(h.jsx)(M.a,{align:"right",children:"Delete"})]})}),Object(h.jsx)(L.a,{children:O.map((function(e,t){return Object(h.jsxs)(A.a,{children:[Object(h.jsx)(M.a,{component:"th",scope:"row",children:t}),Object(h.jsx)(M.a,{align:"right",children:e.id}),Object(h.jsx)(M.a,{align:"right",children:e.fileName}),Object(h.jsx)(M.a,{align:"right",children:e.fileSize}),Object(h.jsx)(M.a,{align:"right",children:e.operation}),Object(h.jsx)(M.a,{align:"right",children:Object(h.jsx)(K.a,{className:"roomTalbeDelete",onClick:function(t){var r=O.filter((function(t){return t.id!=e.id}));_.rooms.update(n,{roomData:r}),f((function(e){return r}))}})})]},t)}))})]})}):Object(h.jsx)("div",{className:"roomBottomContainerNoData",children:Object(h.jsx)("p",{children:"You dont have any data to disply \ud83d\ude41"})})}),Object(h.jsx)("input",{className:ne?"room_sendFile buttonDisabled":"room_sendFile",disabled:ne,type:"file",title:"Select File",multiple:!0,onChange:function(e){try{var t=e.target.files;console.log("Files Length",t.length);for(var r=function(){console.log("file",t[c]);var e=JSON.stringify({name:t[c].name,type:t[c].type,size:t[c].size});console.log(e),t[c].arrayBuffer().then((function(t){for(R.current.send("Meta-".concat(e));t.byteLength;){var r=t.slice(0,16384);t=t.slice(16384,t.byteLength),R.current.send(r)}R.current.send("Done-".concat(e)),$((function(t){return[].concat(Object(E.a)(t),[JSON.parse(e)])}));var c=JSON.parse(e);f((function(e){return[].concat(Object(E.a)(e),[{id:I.a.v4(),fileName:c.name,fileSize:he(c.size),operation:"sent"}])})),ce.current.push({id:I.a.v4(),fileName:c.name,fileSize:he(c.size),operation:"sent"}),_.rooms.update({roomId:n},{roomData:ce.current})}))},c=0;c<t.length;c++)r()}catch(o){console.log(o)}}}),Object(h.jsxs)(j.a,{open:!ie,onClose:function(){se(!0)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(h.jsx)(m.a,{id:"alert-dialog-title",children:"Url"}),Object(h.jsx)(d.a,{children:Object(h.jsx)(b.a,{id:"alert-dialog-description",children:"Url copied to your clipboard. Share this with peer to start sharing"})})]})]})};n(160);var $=function(){return Object(h.jsx)("div",{className:"page404",children:Object(h.jsxs)("div",{className:"page404_container",children:[Object(h.jsxs)("h1",{children:["404",Object(h.jsx)("span",{children:" Error"})]}),Object(h.jsx)("img",{src:"/page404.png",width:"400px"})]})})};var ee=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){localStorage.getItem("user")&&c(!0)}),[]),Object(h.jsx)("div",{className:"app",children:Object(h.jsx)(u.Provider,{value:{auth:n,setAuth:c},children:n?Object(h.jsx)(s.a,{children:Object(h.jsxs)(l.c,{children:[Object(h.jsx)(l.a,{path:"/room/:roomId/:roomName",children:Object(h.jsx)(X,{})}),Object(h.jsx)(l.a,{exact:!0,path:"/",children:Object(h.jsx)(B,{})}),Object(h.jsx)(l.a,{path:"*",component:$})]})}):Object(h.jsx)(O,{})})})};a.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(s.a,{children:Object(h.jsx)(ee,{})})}),document.getElementById("root"))}},[[161,1,2]]]);
//# sourceMappingURL=main.1e52e916.chunk.js.map